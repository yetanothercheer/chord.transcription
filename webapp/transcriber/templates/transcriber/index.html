{% extends 'transcriber/base.html' %}

{% block content %}
<div class="max-w-6xl mx-auto space-y-6">
    <!-- Compact Control Section -->
    <div class="max-w-3xl mx-auto">
        <form hx-post="/upload/" hx-encoding="multipart/form-data" hx-swap="none" hx-on::after-request="if(event.detail.successful) { 
                const data = JSON.parse(event.detail.xhr.responseText);
                document.querySelectorAll('input[name=\'file_path\']').forEach(i => i.value = data.file_path);
                const fileNameEl = document.getElementById('file-name');
                if (fileNameEl) {
                    fileNameEl.textContent = data.file_name;
                    fileNameEl.classList.remove('hidden');
                }
                const uploadText = document.getElementById('upload-text');
                if (uploadText) uploadText.classList.add('hidden');
                document.getElementById('current-task-status').textContent = data.file_name;
            }">
            <div onclick="document.getElementById('file-input').click()"
                class="relative overflow-hidden bg-base-200/50 border border-white/5 rounded-2xl p-6 hover:bg-base-200 hover:border-primary/30 transition-all duration-300 cursor-pointer group shadow-xl">
                <div class="relative z-10 flex flex-col sm:flex-row items-center justify-center gap-6">
                    <div
                        class="flex items-center justify-center w-12 h-12 bg-primary/10 rounded-xl group-hover:scale-110 transition-transform shadow-inner">
                        <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                        </svg>
                    </div>
                    <div id="upload-text" class="text-center sm:text-left">
                        <p class="text-lg font-black tracking-tight">Load Audio Source</p>
                        <p class="text-[9px] uppercase tracking-widest opacity-40 font-black">Cloud Processing â€¢ Local
                            Privacy</p>
                    </div>
                    <p id="file-name" class="hidden text-sm font-black text-primary truncate max-w-[200px]"></p>
                    <input type="file" name="audio" id="file-input" accept="audio/*" class="hidden"
                        onchange="this.form.dispatchEvent(new Event('submit', {bubbles: true}))">
                </div>
            </div>
        </form>

        {% if available_songs %}
        <div class="mt-4 flex flex-wrap justify-center gap-1.5 px-4">
            {% for song in available_songs %}
            <button
                class="btn btn-ghost btn-xs bg-base-200/30 hover:bg-primary/10 border border-white/5 rounded-lg px-2.5 transition-all text-[9px] font-black uppercase tracking-tighter opacity-60 hover:opacity-100"
                onclick="selectSong('{{ song.path }}', '{{ song.name }}')">
                {{ song.name }}
            </button>
            {% endfor %}
        </div>
        {% endif %}
    </div>

    <!-- Main Module Section -->
    <div class="space-y-3">
        <div class="flex items-center justify-between px-1">
            <h3 class="text-[9px] font-black uppercase tracking-[0.4em] opacity-30">Analytical Matrix</h3>
            <div
                class="badge badge-primary badge-outline h-5 px-3 font-black text-[8px] tracking-[0.2em] opacity-80 rounded-md">
                STATUS: IDLE</div>
        </div>

        <div role="tablist" class="tabs tabs-lifted tabs-lg">
            <input type="radio" name="main_tabs" role="tab"
                class="tab font-black text-[10px] uppercase tracking-widest [--tab-bg:oklch(var(--b2))] [--tab-border-color:transparent]"
                aria-label="Pipeline" checked />
            <div role="tabpanel"
                class="tab-content bg-base-200/50 border-base-300 rounded-box p-6 shadow-2xl backdrop-blur-3xl min-h-[400px]">
                {% include 'transcriber/tabs/pipeline.html' %}
            </div>

            <input type="radio" name="main_tabs" role="tab"
                class="tab font-black text-[10px] uppercase tracking-widest [--tab-bg:oklch(var(--b2))] [--tab-border-color:transparent]"
                aria-label="Stems" />
            <div role="tabpanel"
                class="tab-content bg-base-200/50 border-base-300 rounded-box p-6 shadow-2xl backdrop-blur-3xl min-h-[400px]">
                {% include 'transcriber/tabs/stems.html' %}
            </div>

            <input type="radio" name="main_tabs" role="tab"
                class="tab font-black text-[10px] uppercase tracking-widest [--tab-bg:oklch(var(--b2))] [--tab-border-color:transparent]"
                aria-label="Lyrics" />
            <div role="tabpanel"
                class="tab-content bg-base-200/50 border-base-300 rounded-box p-6 shadow-2xl backdrop-blur-3xl min-h-[400px]">
                {% include 'transcriber/tabs/lyrics.html' %}
            </div>

            <input type="radio" name="main_tabs" role="tab"
                class="tab font-black text-[10px] uppercase tracking-widest [--tab-bg:oklch(var(--b2))] [--tab-border-color:transparent]"
                aria-label="Chords" />
            <div role="tabpanel"
                class="tab-content bg-base-200/50 border-base-300 rounded-box p-6 shadow-2xl backdrop-blur-3xl min-h-[400px]">
                {% include 'transcriber/tabs/chords.html' %}
            </div>

            <input type="radio" name="main_tabs" role="tab"
                class="tab font-black text-[10px] uppercase tracking-widest [--tab-bg:oklch(var(--b2))] [--tab-border-color:transparent]"
                aria-label="Notes" />
            <div role="tabpanel"
                class="tab-content bg-base-200/50 border-base-300 rounded-box p-6 shadow-2xl backdrop-blur-3xl min-h-[400px]">
                {% include 'transcriber/tabs/notes.html' %}
            </div>
        </div>
    </div>
</div>
{% endblock %}